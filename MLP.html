<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MLP</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li><a href="#mlp---multy-layers-proceptron">MLP - Multy Layers Proceptron</a>
<ul>
<li><a href="#немного-теории">Немного теории</a></li>
<li><a href="#mlp-в-библиотеке-opencv">MLP в библиотеке OpenCV</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="mlp---multy-layers-proceptron">MLP - Multy Layers Proceptron</h1>
<h2 id="немного-теории">Немного теории</h2>
<h3 id="постановка-задачи">Постановка задачи:</h3>
<p><img src="https://i.imgur.com/EkXTFWD.png" alt="Многослойный процептрон"></p>
<p>Пусть у нас есть нейронная сеть, которая имеет пять входов и три выхода. Мы имеем следующие данные.</p>
<ol>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi><mo>=</mo><mo>(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>X</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>X</mi><mi>k</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">X =(X_1, X_2, ..., X_k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span style="margin-right: 0.07847em;" class="mord mathit">X</span><span class="mrel">=</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathit">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mpunct">,</span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathit">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mpunct">,</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mpunct">,</span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathit">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathit mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> - Входные данные - признаки (вектора)</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mo>=</mo><mo>(</mo><msub><mi>A</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>A</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>A</mi><mi>k</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">A=(A_1, A_2, ..., A_k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord mathit">A</span><span class="mrel">=</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mpunct">,</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathit mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>- Ответы</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>X</mi><mo separator="true">,</mo><mi>A</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(X, A)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mopen">(</span><span style="margin-right: 0.07847em;" class="mord mathit">X</span><span class="mpunct">,</span><span class="mord mathit">A</span><span class="mclose">)</span></span></span></span></span> - Обучающая выборка</li>
<li>W - вектор, содержащий все веса  нейронной сети<br>
4.Y =  N(W, X) - Функция нейронной сети. Она получает входные данные, веса и возвращает ответ на текущих данных. Y - ответ нейронной сети</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mo>(</mo><mi>Y</mi><mo separator="true">,</mo><mi>A</mi><mo>)</mo><mo>=</mo><msubsup><mi mathvariant="normal">Σ</mi><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><mo>(</mo><mi>Y</mi><mo>[</mo><mi>j</mi><mo>]</mo><mo>−</mo><mi>A</mi><mo>[</mo><mi>j</mi><mo>]</mo><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">D(Y, A) = \Sigma_{j=1}^{m} (Y[j]-A[j])^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.814108em;"></span><span class="strut bottom" style="height: 1.20888em; vertical-align: -0.394772em;"></span><span class="base"><span style="margin-right: 0.02778em;" class="mord mathit">D</span><span class="mopen">(</span><span style="margin-right: 0.22222em;" class="mord mathit">Y</span><span class="mpunct">,</span><span class="mord mathit">A</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord"><span class="mord mathrm">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -2.44134em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.05724em;" class="mord mathit mtight">j</span><span class="mrel mtight">=</span><span class="mord mathrm mtight">1</span></span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.394772em;"></span></span></span></span></span><span class="mopen">(</span><span style="margin-right: 0.22222em;" class="mord mathit">Y</span><span class="mopen">[</span><span style="margin-right: 0.05724em;" class="mord mathit">j</span><span class="mclose">]</span><span class="mbin">−</span><span class="mord mathit">A</span><span class="mopen">[</span><span style="margin-right: 0.05724em;" class="mord mathit">j</span><span class="mclose">]</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> - Функция ошибки</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mi>i</mi></msub><mo>(</mo><mi>Y</mi><mo>)</mo><mo>=</mo><mi>D</mi><mo>(</mo><mi>Y</mi><mo separator="true">,</mo><msub><mi>A</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">D_i(Y)=D(Y, A_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathit">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">(</span><span style="margin-right: 0.22222em;" class="mord mathit">Y</span><span class="mclose">)</span><span class="mrel">=</span><span style="margin-right: 0.02778em;" class="mord mathit">D</span><span class="mopen">(</span><span style="margin-right: 0.22222em;" class="mord mathit">Y</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>E</mi><mi>i</mi></msub><mo>(</mo><mi>W</mi><mo>)</mo><mo>=</mo><msub><mi>D</mi><mi>i</mi></msub><mo>(</mo><mi>N</mi><mo>(</mo><mi>W</mi><mo separator="true">,</mo><msub><mi>X</mi><mi>i</mi></msub><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">E_i(W)=D_i(N(W,X_i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathit">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.05764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">(</span><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathit">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">(</span><span style="margin-right: 0.10903em;" class="mord mathit">N</span><span class="mopen">(</span><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="mpunct">,</span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathit">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.07847em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span> - ошибка сети на i-ом примере</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>(</mo><mi>W</mi><mo>)</mo><mo>=</mo><msubsup><mi mathvariant="normal">Σ</mi><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><mo>(</mo><msub><mi>E</mi><mi>i</mi></msub><mo>(</mo><mi>W</mi><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">E(W)=\Sigma_{i=1}^{k}(E_i(W))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.849108em;"></span><span class="strut bottom" style="height: 1.10777em; vertical-align: -0.258664em;"></span><span class="base"><span style="margin-right: 0.05764em;" class="mord mathit">E</span><span class="mopen">(</span><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord"><span class="mord mathrm">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.849108em;"><span class="" style="top: -2.44134em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mathrm mtight">1</span></span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathit mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.258664em;"></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathit">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.05764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mopen">(</span><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span> - Ошибка сети на всей обучающей выборке<br>
<strong>Найти:</strong><br>
вектор W такой, что <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>(</mo><mi>W</mi><mo>)</mo><mo>→</mo><mi>m</mi><mi>i</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">E(W)\rightarrow min</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span style="margin-right: 0.05764em;" class="mord mathit">E</span><span class="mopen">(</span><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="mclose">)</span><span class="mrel">→</span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">n</span></span></span></span></span> (Найти такие веса связей в нейронное сети, что ошибка на контроле будет минимальна)</li>
</ol>
<h3 id="метод-градиентного-спуска">Метод градиентного спуска</h3>
<p><img src="https://picasaweb.google.com/113143883303893122571/6514651016298990785#6514651022275445842" alt="Функция"><br>
Метод заключается в том, чтобы найти минимум функции используя знак производной. Возьмем произвольную точку, и проверим знак первой производной функции в этой точке:</p>
<ol>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal">′</mo></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">f'(x) &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.751892em;"></span><span class="strut bottom" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span></span></span></span></span> - функция возрастает</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal">′</mo></msup><mo>(</mo><mi>x</mi><mo>)</mo><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">f'(x) &lt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.751892em;"></span><span class="strut bottom" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">&lt;</span><span class="mord mathrm">0</span></span></span></span></span> - функция убывает</li>
</ol>
<p>Теперь мы делаем шаг в противоположном направлении от возрастания функции: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msup><mi>f</mi><mo mathvariant="normal">′</mo></msup><mo>(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>)</mo><msub><mi>x</mi><mn>3</mn></msub><mo>=</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msup><mi>f</mi><mo mathvariant="normal">′</mo></msup><mo>(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>)</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">x_2=x_1-f'(x_1) x_3=x_2-f'(x_2)....</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.751892em;"></span><span class="strut bottom" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mbin">−</span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mbin">−</span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span></span></span></span></span> выполняем до тех пор пока мы не встретим точку, в которой производная равна нулю<br>
<strong>Алгоритм (Функция одной переменной):</strong></p>
<ol>
<li>Инициализировать  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span></span></span></span></span> случайным значением из R</li>
<li>i = 1</li>
<li><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mi>e</mi><msup><mi>f</mi><mo mathvariant="normal">′</mo></msup><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">x_{i+1}=x_i-ef'(x_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.751892em;"></span><span class="strut bottom" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">+</span><span class="mord mathrm mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"></span></span></span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mbin">−</span><span class="mord mathit">e</span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li>
<li>i++</li>
<li>if <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>)</mo><mo>−</mo><mi>f</mi><mo>(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>&gt;</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">f(x_{i})-f(x_{i+1})&gt; c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span><span class="mbin">−</span><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">+</span><span class="mord mathrm mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"></span></span></span></span></span><span class="mclose">)</span><span class="mrel">&gt;</span><span class="mord mathit">c</span></span></span></span></span>  goto 3</li>
</ol>
<p><strong>Алгоритм (Функция нескольких переменных):</strong><br>
6.  Инициализировать  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">W_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="base"><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span></span></span></span></span> случайным значением из <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>R</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">R^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord"><span style="margin-right: 0.00773em;" class="mord mathit">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span></span></span></span></span></span></span></span></span><br>
7. i = 1<br>
8. <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>W</mi><mi>i</mi></msub><mo>−</mo><mi>e</mi><mi mathvariant="normal">∇</mi><mi>f</mi><mo>(</mo><msub><mi>W</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">W_{i+1}=W_i-e\nabla f(W_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">+</span><span class="mord mathrm mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"></span></span></span></span></span><span class="mrel">=</span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mbin">−</span><span class="mord mathit">e</span><span class="mord mathrm">∇</span><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span></span></span></span></span><br>
9. i++<br>
10. if <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><msub><mi>W</mi><mi>i</mi></msub><mo>)</mo><mo>−</mo><mi>f</mi><mo>(</mo><msub><mi>W</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>)</mo><mo>&gt;</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">f(W_{i})-f(W_{i+1})&gt; c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span><span class="mclose">)</span><span class="mbin">−</span><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathit">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">+</span><span class="mord mathrm mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"></span></span></span></span></span><span class="mclose">)</span><span class="mrel">&gt;</span><span class="mord mathit">c</span></span></span></span></span>  goto 3</p>
<p>Для обучения нейронной сети нам требуется минимизировать  формулу 7.</p>
<h2 id="mlp-в-библиотеке-opencv">MLP в библиотеке OpenCV</h2>
<h3 id="подготовка-данных">Подготовка данных</h3>
<p>Библиотека OpenCV имеет несколько структур данных, но мы рассмотрим одну из них <code>Mat</code><br>
Класс Mat предствавляет плотные n-мерные числовые одноканальные или многоканальные массивы. Может быть использован для хранения дейтсвительных или комплекснозначных векторов и матриц, в оттенках серого или цветных изображений, векторных полей, тензоров, гистограмм. В коде будет использован шаблонный класс <code>Mat_</code> - это обертка над классом <code>Mat</code> , которую удобно использовать если тип хранимого объекта известен на стадии компиляции.<br>
<strong>Некоторые особенности:</strong></p>
<ol>
<li>операция присваивания не выполняет копирование матрицы, она только копирует внутреннее описания объекта и ссылку на матрицу в памяти (с увеличением счетчика ссылок). (Используется умный указатель)</li>
<li>Для копирования матрицы требуется воспользоваться методом Mat::clone().</li>
</ol>
<p><strong>Генерируем данные:</strong><br>
Для начало мы создадим данные по которым будем обучать сеть (Делаем для примера).<br>
Начнем подготовку данных для обучения сети.<br>
Создадим матрицу 100x100. Где каждая строка это признаки объекта.<br>
Тогда мы имеем 100 признаков у объекта и 100 объектов</p>
<pre class=" language-c"><code class="prism ++11 language-c">Mat_<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Заполним  матрицу случайными числами из нормального распределения с параметрами:  mean = 0, sd = 1</p>
<pre class=" language-c"><code class="prism ++11 language-c"><span class="token function">randn</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> Mat<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Mat<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Функции <code>Mat::zeros(rows, cols, type)</code> <code>Mat::ones(rows, cols, type)</code> создают матрицы заполненные нулями и единицами соответственно. Чтобы установить семя для генератора случайных чисел, надо воспользоваться следующей конструкцией:</p>
<pre class=" language-c"><code class="prism ++11 language-c">cv<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">theRNG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>state <span class="token operator">=</span> seed<span class="token punctuation">;</span>
</code></pre>
<p>Поскольку OpenCV разработан с поддержкой много поточности, то семя устанавливается для каждого потока отдельно</p>
<p>Обучающая выборка представляет собой матрицу “Объекты-признаки” и матрицу ответов. Мы будем разбивать данные на два класса. Создадим матрицу ответов, которая будет содержать две колонки, первая для первого класса, вторая для второго.</p>
<pre class=" language-c"><code class="prism ++11 language-c">Mat_<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">responses</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Если объект принадлежит первому классу, то первая колонка заполнена единице, а вторая нулем. Если объект из второго класса то первая колонка содержит ноль, а вторая единицу.(Разделим нашу выборку на два класса по палам)</p>
<pre class=" language-c"><code class="prism ++11 language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>data<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>rows<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">responses</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">responses</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token function">responses</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token function">responses</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>Теперь мы имеем обучающую выборку, которая представляет собой два объекта: Матрица “Объекты-признаки” -  data. Матрица ответов - responses</p>
<h3 id="создание-и-обучение-нейронной-сети">Создание и Обучение нейронной сети</h3>
<p>Библиотека OpenCV имеет класс умных указателей <code>Ptr&lt;T&gt;</code>, которые представлю собой полный  аналог <code>shared_ptr</code> из boost или стандартной библиотеки<br>
Для создания не настроенной пустой нейронной сети воспользуемся статическим методом create</p>
<pre class=" language-c"><code class="prism ++11 language-c">Ptr<span class="token operator">&lt;</span>ANN_MLP<span class="token operator">&gt;</span> network <span class="token operator">=</span> ANN_MLP<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Данная нейронная сеть пуста, нам требуется указать сколько слоев и сколько нейронов в каждом слое. Создадим матрицу, которая будет содержать данную информацию</p>
<pre class=" language-c"><code class="prism ++11 language-c">Mat_<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">layerSizes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Первый слой - это входа в сеть. их столько сколько и признаков</span>
	<span class="token function">layerSizes</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>cols<span class="token punctuation">;</span> 
	<span class="token function">layerSizes</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token comment">//скрытый слой</span>
<span class="token comment">//выходной слой. Их столько сколько должно быть ответов. в нашем случае 2</span>
	<span class="token function">layerSizes</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> responses<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
</code></pre>
<p>Информацию о количестве нейронов и слоях надо передать объекту нейронной сети. количество слоев это количество колонок в матрице</p>
<pre class=" language-c"><code class="prism ++11 language-c">network<span class="token operator">-&gt;</span><span class="token function">setLayerSizes</span><span class="token punctuation">(</span>layerSizes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Нам осталось указать, какой функцией активации мы хотели бы воспользоваться и каким методом обучать сеть:</p>
<pre class=" language-c"><code class="prism ++11 language-c">virtual <span class="token keyword">void</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span>ml<span class="token punctuation">:</span><span class="token punctuation">:</span>ANN_MLP<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">setActivationFunction</span><span class="token punctuation">(</span><span class="token keyword">int</span> type<span class="token punctuation">,</span><span class="token keyword">double</span> param1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">double</span> param2 <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> 	
</code></pre>
<p>type - тип функции активации<br>
param1 - параметр <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.43056em; vertical-align: 0em;"></span><span class="base"><span style="margin-right: 0.0037em;" class="mord mathit">α</span></span></span></span></span><br>
param2 -  параметр <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.69444em;"></span><span class="strut bottom" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="base"><span style="margin-right: 0.05278em;" class="mord mathit">β</span></span></span></span></span></p>

<table>
<thead>
<tr>
<th>Тип</th>
<th>Функция активации</th>
</tr>
</thead>
<tbody>
<tr>
<td>IDENTITY</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">f(x)=x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit">x</span></span></span></span></span></td>
</tr>
<tr>
<td>SIGMOID_SYM</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>β</mi><mo>∗</mo><mo>(</mo><mn>1</mn><mo>−</mo><msup><mi>e</mi><mrow><mo>−</mo><mi>α</mi><mi>x</mi></mrow></msup><mo>)</mo><mi mathvariant="normal">/</mi><mo>(</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>−</mo><mi>α</mi><mi>x</mi></mrow></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">f(x)=\beta *(1-e^{-\alpha x})/(1+e^{-\alpha x})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.771331em;"></span><span class="strut bottom" style="height: 1.02133em; vertical-align: -0.25em;"></span><span class="base"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span style="margin-right: 0.05278em;" class="mord mathit">β</span><span class="mbin">∗</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span style="margin-right: 0.0037em;" class="mord mathit mtight">α</span><span class="mord mathit mtight">x</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathrm">/</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">+</span><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span style="margin-right: 0.0037em;" class="mord mathit mtight">α</span><span class="mord mathit mtight">x</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></td>
</tr>
<tr>
<td></td>
<td>Если используются параметры по умолчанию, то тогда используется другая функция: <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">.</mi><mn>7</mn><mn>1</mn><mn>5</mn><mn>9</mn><mo>∗</mo><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi><mo>(</mo><mn>2</mn><mi mathvariant="normal">/</mi><mn>3</mn><mo>∗</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">y = 1.7159*tanh(2/3*x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.75em;"></span><span class="strut bottom" style="height: 1em; vertical-align: -0.25em;"></span><span class="base"><span style="margin-right: 0.03588em;" class="mord mathit">y</span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">7</span><span class="mord mathrm">1</span><span class="mord mathrm">5</span><span class="mord mathrm">9</span><span class="mbin">∗</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">h</span><span class="mopen">(</span><span class="mord mathrm">2</span><span class="mord mathrm">/</span><span class="mord mathrm">3</span><span class="mbin">∗</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span></span>, область значений: [-1.7159; 1.7159]; область определения: [0;1]</td>
</tr>
<tr>
<td>GAUSSIAN</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>β</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>α</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></msup></mrow><annotation encoding="application/x-tex">f(x)=\beta e^{-\alpha x^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.98692em;"></span><span class="strut bottom" style="height: 1.23692em; vertical-align: -0.25em;"></span><span class="base"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span style="margin-right: 0.05278em;" class="mord mathit">β</span><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.98692em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span style="margin-right: 0.0037em;" class="mord mathit mtight">α</span><span class="mord mtight"><span class="mord mathit mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.891314em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></td>
</tr>
</tbody>
</table><p>Воспользуемся сигмоидной функцией активации</p>
<pre class=" language-c"><code class="prism ++11 language-c">network<span class="token operator">-&gt;</span><span class="token function">setActivationFunction</span><span class="token punctuation">(</span>ANN_MLP<span class="token punctuation">:</span><span class="token punctuation">:</span>SIGMOID_SYM<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Установка метода обучения:</p>
<pre class=" language-c"><code class="prism ++11 language-c">virtual <span class="token keyword">void</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span>ml<span class="token punctuation">:</span><span class="token punctuation">:</span>ANN_MLP<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">setTrainMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> method<span class="token punctuation">,</span> <span class="token keyword">double</span> param1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">double</span> param2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre>

<table>
<thead>
<tr>
<th>Параметры\Тип метода обучения</th>
<th>BACKPROP</th>
<th>RPROP</th>
</tr>
</thead>
<tbody>
<tr>
<td>param1</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>param2</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table><pre class=" language-c"><code class="prism ++11 language-c">network<span class="token operator">-&gt;</span><span class="token function">setTrainMethod</span><span class="token punctuation">(</span>ANN_MLP<span class="token punctuation">:</span><span class="token punctuation">:</span>BACKPROP<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Создадим объект обучающей выборки и перейдем у обучению</p>
<pre class=" language-c"><code class="prism ++11 language-c">Ptr<span class="token operator">&lt;</span>TrainData<span class="token operator">&gt;</span> trainData <span class="token operator">=</span> TrainData<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> ROW_SAMPLE<span class="token punctuation">,</span> responses<span class="token punctuation">)</span><span class="token punctuation">;</span>
network<span class="token operator">-&gt;</span><span class="token function">train</span><span class="token punctuation">(</span>trainData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="использование">Использование</h3>
<pre class=" language-c"><code class="prism ++11 language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>network<span class="token operator">-&gt;</span><span class="token function">isTrained</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Predict one-vector:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Mat result<span class="token punctuation">;</span>
		network<span class="token operator">-&gt;</span><span class="token function">predict</span><span class="token punctuation">(</span>Mat<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> result <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Predict training data:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>data<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			network<span class="token operator">-&gt;</span><span class="token function">predict</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
			cout <span class="token operator">&lt;&lt;</span> result <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre>
<p><strong>Весь код программы:</strong></p>
<pre class=" language-c"><code class="prism ++11 language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/ml/ml.hpp&gt;</span></span>

using namespace std<span class="token punctuation">;</span>
using namespace cv<span class="token punctuation">;</span>
using namespace cv<span class="token punctuation">:</span><span class="token punctuation">:</span>ml<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">//создания случайной обучающей выборки</span>
	Mat_<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//матрица 100x100</span>
	<span class="token function">theRNG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token number">2015</span><span class="token punctuation">;</span>
	<span class="token function">randn</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> Mat<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Mat<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat_<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">data2</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">theRNG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token number">2015</span><span class="token punctuation">;</span>
	<span class="token function">randn</span><span class="token punctuation">(</span>data2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//разделим выборку по полам. первая часть отнесем к первому классу</span>
	<span class="token comment">//вторую часть отнесем ко второму классу</span>
	Mat_<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> <span class="token function">responses</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//матрица ответов (Метки классов)</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>data<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">responses</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token function">responses</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			<span class="token function">responses</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token function">responses</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/*
	//example code for just a single response (regression)
	Mat_&lt;float&gt; responses(data.rows, 1);
	for (int i=0; i&lt;responses.rows; ++i)
	responses(i, 0) = i &lt; responses.rows / 2 ? 0 : 1;
	*/</span>

	<span class="token comment">//создание нейронной сети</span>
	Mat_<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">layerSizes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">layerSizes</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
	<span class="token function">layerSizes</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token function">layerSizes</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> responses<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>

	Ptr<span class="token operator">&lt;</span>ANN_MLP<span class="token operator">&gt;</span> network <span class="token operator">=</span> ANN_MLP<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	network<span class="token operator">-&gt;</span><span class="token function">setLayerSizes</span><span class="token punctuation">(</span>layerSizes<span class="token punctuation">)</span><span class="token punctuation">;</span>
	network<span class="token operator">-&gt;</span><span class="token function">setActivationFunction</span><span class="token punctuation">(</span>ANN_MLP<span class="token punctuation">:</span><span class="token punctuation">:</span>SIGMOID_SYM<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	network<span class="token operator">-&gt;</span><span class="token function">setTrainMethod</span><span class="token punctuation">(</span>ANN_MLP<span class="token punctuation">:</span><span class="token punctuation">:</span>BACKPROP<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Ptr<span class="token operator">&lt;</span>TrainData<span class="token operator">&gt;</span> trainData <span class="token operator">=</span> TrainData<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> ROW_SAMPLE<span class="token punctuation">,</span> responses<span class="token punctuation">)</span><span class="token punctuation">;</span>

	network<span class="token operator">-&gt;</span><span class="token function">train</span><span class="token punctuation">(</span>trainData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>network<span class="token operator">-&gt;</span><span class="token function">isTrained</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Predict one-vector:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Mat result<span class="token punctuation">;</span>
		network<span class="token operator">-&gt;</span><span class="token function">predict</span><span class="token punctuation">(</span>Mat<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> result <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Predict training data:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>data<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			network<span class="token operator">-&gt;</span><span class="token function">predict</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
			cout <span class="token operator">&lt;&lt;</span> result <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

    </div>
  </div>
</body>

</html>
